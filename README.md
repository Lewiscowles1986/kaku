[![Downloads](https://img.shields.io/pypi/v/kaku.svg)](https://pypi.python.org/pypi/kaku/)
[![Requirements Status](https://requires.io/github/bear/kaku/requirements.svg?branch=master)](https://requires.io/github/bear/kaku/requirements/?branch=master)

書く- to write

This is the code I have used to enable handling of dynamic IndieWeb events suche as Micropub and Webmentions for [my static site](https://bear.im/bearlog).

This code is very opinionated and was written for my own use, but can still be used by others with some configuration and template changes.

Currently Kaku implements:
- a Micropub endpoint ```/micropub``` that handles create evnts
- a Webmention endpoint ```/webmention```
- an Indieauth set of endpoints ```/login```, ```/logout```, ```/auth``` and ```/success```
- a Token generation endpoint ```/token```

As much as possible Kaku uses the configuration of the static site generator and it's templates.

## Configuration

Kaku uses a ```settings.py``` configuration file and includes a default one for reference at https://github.com/bear/kaku/blob/master/kaku/settings.py and kaku_events.py uses a json config file, see https://github.com/bear/kaku/blob/master/kaku_events.py for an example of it.

## Requirements and Assumptions
- Python v2.7
- Kaku is written using Flask and takes advantage of the builtin Jinja templates
- Because Kaku needs to handle the occasional state information for authentication and authorization, it requires a Redis database to work with locally
- Flask is configured to take advantage of the Redis database for caching in production
- Kaku doesn't do anything with the Micropub or the Webmention calls, instead it publishes them Redis Pub/Sub to be processed later

## Installation
All of the dependencies are outlined in a pip installable '''requirements.txt''' file.

## Running

First start the event handler

```
python --config ./kaku_events.cfg
```

and then the Flask app

```
 KAKU_SETTINGS=./kaku_settings.py uwsgi --socket 127.0.0.1:5000 --module service --callable application
```

## Events

Included in this repo is a standalone Python app that uses Redis Pub/Sub for event handling named ```kaku_events.py```

```
$ python kaku_events.py --help
usage: kaku_events.py [-h] [--config CONFIG] [--file FILE] [--force]

optional arguments:
  -h, --help       show this help message and exit
  --config CONFIG
  --file FILE      A specific markdown file to check and then exit
  --force          Force any found markdown files (or specific file) to be
                   considered an update.
```

Each file that is determined to be new, updated or deleted will have a Kaku Event generated -- which is fancy talk for it building a json blob and calling Redis ```publish``` on the ```kaku-event``` channel.

This app is also responsible for handling the Micropub and Webmention events generated by the main Kaku Flask app.

Any change to a file will cause the HTML output for that file and the index page to be regenerated.

## TODO
handle the following requests:

- ```GET /.well-known/browserid?domain=palala.org```
- Micropub Edit and Delete events
